---
  - name: "install dependencies."
    become: true
    apt:
      name: "tar"
      state: latest
      update_cache: yes

  - name: Copy backend dist files to remote server
    copy:
      src: /root/project/backend
      dest: /home/ubuntu
  
  - name: Install Node modules
    shell: |
      cd /home/ubuntu/backend
      npm install

  - name: Building backend
    shell: |
      cd /home/ubuntu/backend
      npm i
      npm run build

  - name: Start pm2 service
    shell: |
      cd /home/ubuntu/backend
      pm2 start npm --name backend -- start

  # - name: Run app
  #   shell: 
  #     chdir: ~/backend
  #     cmd: pm2 start ./dist/main.js

  # - name: Configure pm2
  #   shell: |
  #     eval $(pm2 startup | tail -1)\n\
  #     pm2 save
